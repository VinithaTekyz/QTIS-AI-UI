<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Quasar + Vue Chatbot</title>
  <!-- Quasar CSS -->
  <link href="https://cdn.jsdelivr.net/npm/quasar@2.17.4/dist/quasar.prod.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    .messenger-bar {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #0d4f8a;
      color: white;
      border-radius: 12px;
      padding: 8px 14px;
      display: flex;
      align-items: center;
      gap: 10px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
      cursor: pointer;
      z-index: 9999;
      min-width: 180px;
    }
    .messenger-bar img {
      width: 32px;
      height: 32px;
      border-radius: 50%;
    }
  </style>
</head>

<body class="q-pa-md">
  <div>
    <div id="q-app">
      <!-- Floating Chat Button -->
      <div v-show="showIcon && !showChat"
        style="position: fixed; bottom: 20px; right: 40px; z-index: 9999; animation: fadeDark 2s infinite ease-in-out;">
        <img src="https://i.postimg.cc/g2HH8Fk2/chatbot-bubble.png" alt="Chatbot" @click="toggleChat"
          style="width: 200px; height: 100px; cursor: pointer;" />
      </div>

      <!-- Messenger Style Minimized Bar -->
      <div
        v-if="isMinimized && showChat"
        class="messenger-bar"
        @click="restoreChat"
      >
        <img
          src="https://cdn3.iconfinder.com/data/icons/customer-service-color/64/support_customer_service_technical_support_avatar_call_center_agent_customer_support_man_support_agent_call_center-512.png"
        />
        <span class="font-medium">Chat with Qtis</span>
        <q-badge v-if="unreadCount > 0" color="red" floating>{{ unreadCount }}</q-badge>
      </div>

      <!-- Chat Panel -->
      <q-dialog
        v-model="showChat"
        position="bottom-right"
        backdrop-filter="blur(4px)"
        transition-hide="fade"
        transition-show="slide-up"
        transition-duration="200"
        style="z-index:20;position: fixed !important; bottom: 10px !important; right: 10px !important;">
        <q-card
          v-show="!isMinimized"
          :style="cardStyle"
          class="q-pa-none"
        >
          <!-- HEADER -->
          <div
            style="position: relative; background-image: linear-gradient(to right, #091c2d, #627ee7); color: white; padding: 10px 15px 30px;">
            <div style="display: flex; align-items: center; gap: 10px; padding-bottom: 1px;">
              <q-toolbar>
                <q-avatar>
                  <img
                    src="https://cdn3.iconfinder.com/data/icons/customer-service-color/64/support_customer_service_technical_support_avatar_call_center_agent_customer_support_man_support_agent_call_center-512.png">
                </q-avatar>
                <q-toolbar-title><span style="font-size: 18px; font-weight: bold;">Qtis</span> Assistant</q-toolbar-title>
                <q-btn flat round dense icon="remove" @click="minimizeChat" />
                <q-btn flat round dense icon="close" v-close-popup @click="toggleChat" />
              </q-toolbar>
            </div>
          </div>

          <!-- Messages -->
          <q-card-section style="flex: 1; overflow-y: auto;" ref="chatContainer">
            <template v-for="(msg, index) in messages" :key="index">
              <!-- User message -->
              <div v-if="msg.from === 'user'"
                style="display: flex; align-items: flex-end; justify-content: flex-end; margin-bottom: 8px; margin-left:40px">
                <q-chat-message text-color="white" sent bg-color="indigo-10"
                  style="background:#1A237E; border-radius:10px; max-width: max-content;">
                  <div v-html="msg.text"></div>
                </q-chat-message>
              </div>
              <!-- Bot message -->
              <div v-if="msg.from === 'bot'"
                style="display: flex; align-items: flex-end; justify-content: flex-start; margin-bottom: 8px; margin-right:40px;">
                <img
                  src="https://cdn3.iconfinder.com/data/icons/customer-service-color/64/support_customer_service_technical_support_avatar_call_center_agent_customer_support_man_support_agent_call_center-512.png"
                  style="width:28px; height:28px; border-radius:50%; margin-right:8px;" />
                <q-chat-message bg-color="white" text-color="black" style="border-radius:10px;">
                  <template v-if="msg.isLoading">
                    <q-spinner-dots size="2rem" />
                  </template>
                  <template v-else>
                    <div v-html="msg.text"></div>
                  </template>
                </q-chat-message>
              </div>
            </template>
          </q-card-section>

          <!-- Input -->
          <q-card-actions align="center" style="padding:8px;">
            <q-input rounded v-model="newMessage" placeholder="Type your message..." @keyup.enter="sendMessage"
              style="flex:1;" />
            <q-btn flat style="color:#0d4f8a" icon="send" @click="sendMessage" />
          </q-card-actions>
        </q-card>
      </q-dialog>
    </div>
  </div>

  <!-- Vue -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <!-- Quasar -->
  <script src="https://cdn.jsdelivr.net/npm/quasar@2.17.4/dist/quasar.umd.prod.js"></script>

  <script>
    const { createApp, ref } = Vue;

    createApp({
      data() {
        return {
          isMinimized: false,
          showChat: false,
          showIcon: true,
          unreadCount: 0,
          newMessage: '',
          messages: [{ from: 'bot', text: 'Hello! How can I help you?', isLoading: false }]
        }
      },
      methods: {
        toggleChat() {
          this.showChat = !this.showChat;
          this.isMinimized = false;
          this.unreadCount = 0;
        },
        minimizeChat() {
          this.isMinimized = true;
        },
        restoreChat() {
          this.isMinimized = false;
          this.unreadCount = 0;
        },
        cardStyle() {
          return `position: fixed; bottom:20px; right:20px; width:100%; max-width:70vh; min-width:70vh; height:90vh; border-radius:20px;`;
        },
        sendMessage() {
          if (!this.newMessage.trim()) return;
          this.messages.push({ from: 'user', text: this.newMessage });
          this.newMessage = '';
          setTimeout(() => {
            this.messages.push({ from: 'bot', text: 'Got it!' });
            if (this.isMinimized) this.unreadCount++;
          }, 1000);
        }
      }
    })
    .use(Quasar)
    .mount("#q-app");
  </script>

</body>
</html>
